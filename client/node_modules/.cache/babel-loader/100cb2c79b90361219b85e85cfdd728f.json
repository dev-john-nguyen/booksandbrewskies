{"ast":null,"code":"import _defineProperty from\"C:\\\\Users\\\\John\\\\Desktop\\\\Modern React With Redux Projects\\\\beersandbrewskiesproject\\\\booksandbrewskies_dev\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"C:\\\\Users\\\\John\\\\Desktop\\\\Modern React With Redux Projects\\\\beersandbrewskiesproject\\\\booksandbrewskies_dev\\\\client\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _classCallCheck from\"C:\\\\Users\\\\John\\\\Desktop\\\\Modern React With Redux Projects\\\\beersandbrewskiesproject\\\\booksandbrewskies_dev\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\John\\\\Desktop\\\\Modern React With Redux Projects\\\\beersandbrewskiesproject\\\\booksandbrewskies_dev\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"C:\\\\Users\\\\John\\\\Desktop\\\\Modern React With Redux Projects\\\\beersandbrewskiesproject\\\\booksandbrewskies_dev\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"C:\\\\Users\\\\John\\\\Desktop\\\\Modern React With Redux Projects\\\\beersandbrewskiesproject\\\\booksandbrewskies_dev\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";import _inherits from\"C:\\\\Users\\\\John\\\\Desktop\\\\Modern React With Redux Projects\\\\beersandbrewskiesproject\\\\booksandbrewskies_dev\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import React from'react';import{ElementsConsumer,CardElement}from'@stripe/react-stripe-js';import{connect}from'react-redux';import CardSection from'./components/CardSection';import IdentitySection from'./components/IdentitySection';import AddressSection from'./components/AddressSection';import'./css/CheckoutFormStyles.css';import Spinner from'../../../spinner';import CartSection from'./components/CartSection';import{getSessionStorageUpdateCart}from'../util';import{getStripe,storeOrder}from'../../../../services/order/actions';import{clearCart}from'../../../../services/cart/actions';import{clearCartTotal}from'../../../../services/total/actions';import history from'../../../../history';import Mymodal from'../../../Modal';import{Modal}from'react-bootstrap';var CheckoutForm=/*#__PURE__*/function(_React$Component){_inherits(CheckoutForm,_React$Component);function CheckoutForm(){var _getPrototypeOf2;var _this;_classCallCheck(this,CheckoutForm);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(CheckoutForm)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state={name:'',email:'',phone:'',line1:'',city:'',state:'',zip:'',client_secret:'',session_error:false,order_completed:false,payment_failed:false,orderId:'',buttonLoading:false};_this.componentDidMount=function _callee(){var _this$props,cartTotal,cartProducts,response;return _regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this$props=_this.props,cartTotal=_this$props.cartTotal,cartProducts=_this$props.cartProducts;getSessionStorageUpdateCart(cartProducts,cartTotal);if(!(cartProducts.length>0)){_context.next=14;break;}_context.prev=3;_context.next=6;return _regeneratorRuntime.awrap(getStripe(cartTotal,cartProducts));case 6:response=_context.sent;_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](3);return _context.abrupt(\"return\",_this.setState({session_error:true}));case 12:console.log(response);if(response.error){_this.setState({session_error:response.error});}else{_this.setState({client_secret:response.data});}case 14:case\"end\":return _context.stop();}}},null,null,[[3,9]]);};_this.handleSubmit=function _callee2(event){var _this$props2,stripe,elements,cartProducts,cartTotal,_this$state,name,phone,email,line1,city,state,zip,client_secret,result,response;return _regeneratorRuntime.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:event.preventDefault();//set loading icon on button\n_this.setState({buttonLoading:true});_this$props2=_this.props,stripe=_this$props2.stripe,elements=_this$props2.elements,cartProducts=_this$props2.cartProducts,cartTotal=_this$props2.cartTotal;_this$state=_this.state,name=_this$state.name,phone=_this$state.phone,email=_this$state.email,line1=_this$state.line1,city=_this$state.city,state=_this$state.state,zip=_this$state.zip,client_secret=_this$state.client_secret;if(!(!stripe||!elements)){_context2.next=6;break;}return _context2.abrupt(\"return\");case 6:_context2.prev=6;_context2.next=9;return _regeneratorRuntime.awrap(stripe.confirmCardPayment(client_secret,{payment_method:{card:elements.getElement(CardElement),billing_details:{name:name,phone:phone,email:email}},shipping:{name:name,phone:phone,address:{line1:line1,city:city,state:state,postal_code:zip}}}));case 9:result=_context2.sent;if(!result.error){_context2.next=14;break;}_this.setState({payment_failed:true});_context2.next=21;break;case 14:if(!(result.paymentIntent.status==='succeeded')){_context2.next=21;break;}_context2.next=17;return _regeneratorRuntime.awrap(storeOrder(result.paymentIntent,cartProducts,cartTotal,name,phone,email));case 17:response=_context2.sent;if(response.data){sessionStorage.removeItem('cartTotal');sessionStorage.removeItem('cartProducts');_this.props.clearCart();_this.props.clearCartTotal();_this.setState({order_completed:true,orderId:response.data.chargeId});}else{//failed to store order into database\n//handle field to store order into the database\n//It's already in stripe\n//Send antoher request to database indicating it failed\n}_context2.next=21;break;case 21:_context2.next=27;break;case 23:_context2.prev=23;_context2.t0=_context2[\"catch\"](6);console.log(_context2.t0);_this.setState({session_error:true});case 27:case\"end\":return _context2.stop();}}},null,null,[[6,23]]);};_this.handleInputChange=function(event){var target=event.target;var value=target.value;var name=target.name;_this.setState(_defineProperty({},name,value));};return _this;}_createClass(CheckoutForm,[{key:\"render\",value:function render(){var _this2=this;var _this$state2=this.state,name=_this$state2.name,phone=_this$state2.phone,email=_this$state2.email,line1=_this$state2.line1,city=_this$state2.city,state=_this$state2.state,zip=_this$state2.zip,client_secret=_this$state2.client_secret,session_error=_this$state2.session_error,order_completed=_this$state2.order_completed,orderId=_this$state2.orderId,buttonLoading=_this$state2.buttonLoading,payment_failed=_this$state2.payment_failed;var _this$props3=this.props,cartTotal=_this$props3.cartTotal,cartProducts=_this$props3.cartProducts;if(order_completed){var descriptionOrderCompleted=\"Your confirmation number is \".concat(orderId,\".\\n      Check your email for details. If you have any questions or\\n      concerns regarding your order please feel free to contact us.\");return React.createElement(Mymodal,{showValue:true,closeDirect:\"/\",buttonName:\"OK\",title:\"Thank You \".concat(name,\"!\"),description:descriptionOrderCompleted,svgType:\"success\"});}if(cartProducts.length<=0){return React.createElement(Mymodal,{showValue:true,closeDirect:\"/shop\",buttonName:\"Store\",title:\"Cart Is Empty\",description:\"Go pick something from our store!\",svgType:\"empty\"});}if(session_error){var clientErrorDescription=\"Looks like something went wrong.\\n      I apologize for the inconvience. No payment was taken\";return React.createElement(Mymodal,{showValue:true,closeDirect:\"/\",buttonName:\"Close\",title:\"Error\",description:clientErrorDescription,svgType:\"error\"});}if(client_secret===''){return React.createElement(Spinner,null);}if(payment_failed){var descriptionOrderFailed=\"Looks like your card has insufficient funds. No payment was taken.\";return React.createElement(Mymodal,{showValue:true,closeDirect:\"/shop/checkout\",handleState:function handleState(){return _this2.setState({payment_failed:false,buttonLoading:false});},buttonName:\"Try Again\",title:\"Payment Failed\",description:descriptionOrderFailed,svgType:\"warning\"});}var formStuff=React.createElement(React.Fragment,null,React.createElement(CartSection,{cartProducts:cartProducts,cartTotal:cartTotal}),React.createElement(\"form\",{onSubmit:this.handleSubmit},React.createElement(IdentitySection,{name:name,phone:phone,email:email,handleInputChange:this.handleInputChange}),React.createElement(AddressSection,{line1:line1,city:city,state:state,zip:zip,handleInputChange:this.handleInputChange}),React.createElement(CardSection,null),React.createElement(\"button\",{className:\"btn btn-primary btn-block\",disabled:!this.props.stripe},buttonLoading&&React.createElement(\"span\",{className:\"spinner-border spinner-border-sm\",role:\"status\",\"aria-hidden\":\"true\"}),\"Confirm To Pay $\",cartTotal.totalPrice)));var walletSvg=React.createElement(\"svg\",{className:\"bi bi-wallet\",style:{position:'relative',bottom:\"5px\"},width:\"3rem\",height:\"3rem\",viewBox:\"0 0 20 20\",fill:\"currentColor\",xmlns:\"http://www.w3.org/2000/svg\"},React.createElement(\"path\",{\"fill-rule\":\"evenodd\",d:\"M3.5 5a.5.5 0 00-.5.5v2h5a.5.5 0 01.5.5c0 .253.08.644.306.958.207.288.557.542 1.194.542.637 0 .987-.254 1.194-.542.226-.314.306-.705.306-.958a.5.5 0 01.5-.5h5v-2a.5.5 0 00-.5-.5h-13zM17 8.5h-4.551a2.678 2.678 0 01-.443 1.042c-.393.546-1.043.958-2.006.958-.963 0-1.613-.412-2.006-.958A2.679 2.679 0 017.551 8.5H3v6a.5.5 0 00.5.5h13a.5.5 0 00.5-.5v-6zm-15-3A1.5 1.5 0 013.5 4h13A1.5 1.5 0 0118 5.5v9a1.5 1.5 0 01-1.5 1.5h-13A1.5 1.5 0 012 14.5v-9z\",\"clip-rule\":\"evenodd\"}));return React.createElement(Modal,{show:true,onHide:function onHide(){return history.push('/shop');},\"aria-labelledby\":\"contained-modal-title-vcenter\",centered:true},React.createElement(Modal.Header,{closeButton:true},React.createElement(Modal.Title,null,React.createElement(\"div\",{className:\"row\"},walletSvg))),React.createElement(Modal.Body,null,formStuff));}}]);return CheckoutForm;}(React.Component);var InjectedCheckoutForm=function InjectedCheckoutForm(_ref){var cartProducts=_ref.cartProducts,cartTotal=_ref.cartTotal,clearCart=_ref.clearCart,clearCartTotal=_ref.clearCartTotal;return React.createElement(ElementsConsumer,null,function(_ref2){var stripe=_ref2.stripe,elements=_ref2.elements;return React.createElement(CheckoutForm,{stripe:stripe,elements:elements,cartProducts:cartProducts,cartTotal:cartTotal,clearCart:clearCart,clearCartTotal:clearCartTotal});});};var mapStateToProps=function mapStateToProps(state){return{cartTotal:state.total.data,cartProducts:state.cart.products};};export default connect(mapStateToProps,{clearCart:clearCart,clearCartTotal:clearCartTotal})(InjectedCheckoutForm);","map":{"version":3,"sources":["C:/Users/John/Desktop/Modern React With Redux Projects/beersandbrewskiesproject/booksandbrewskies_dev/client/src/components/shop/components/checkout/index.js"],"names":["React","ElementsConsumer","CardElement","connect","CardSection","IdentitySection","AddressSection","Spinner","CartSection","getSessionStorageUpdateCart","getStripe","storeOrder","clearCart","clearCartTotal","history","Mymodal","Modal","CheckoutForm","state","name","email","phone","line1","city","zip","client_secret","session_error","order_completed","payment_failed","orderId","buttonLoading","componentDidMount","props","cartTotal","cartProducts","length","response","setState","console","log","error","data","handleSubmit","event","preventDefault","stripe","elements","confirmCardPayment","payment_method","card","getElement","billing_details","shipping","address","postal_code","result","paymentIntent","status","sessionStorage","removeItem","chargeId","handleInputChange","target","value","descriptionOrderCompleted","clientErrorDescription","descriptionOrderFailed","formStuff","totalPrice","walletSvg","position","bottom","push","Component","InjectedCheckoutForm","mapStateToProps","total","cart","products"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport {ElementsConsumer, CardElement} from '@stripe/react-stripe-js';\r\nimport { connect } from 'react-redux';\r\nimport CardSection from './components/CardSection';\r\nimport IdentitySection from './components/IdentitySection';\r\nimport AddressSection from './components/AddressSection';\r\nimport './css/CheckoutFormStyles.css';\r\nimport Spinner from '../../../spinner'\r\nimport CartSection from './components/CartSection';\r\nimport { getSessionStorageUpdateCart } from '../util';\r\nimport { getStripe, storeOrder } from '../../../../services/order/actions';\r\nimport { clearCart } from '../../../../services/cart/actions';\r\nimport { clearCartTotal } from '../../../../services/total/actions';\r\nimport history from '../../../../history';\r\nimport Mymodal from '../../../Modal';\r\nimport {Modal} from 'react-bootstrap';\r\n\r\nclass CheckoutForm extends React.Component {\r\n\r\n  state = {\r\n    name: '',\r\n    email: '',\r\n    phone: '',\r\n    line1: '',\r\n    city: '',\r\n    state: '',\r\n    zip: '',\r\n    client_secret: '',\r\n    session_error: false,\r\n    order_completed: false,\r\n    payment_failed: false,\r\n    orderId: '',\r\n    buttonLoading: false\r\n  }\r\n\r\n  componentDidMount = async() => {\r\n    const {cartTotal, cartProducts} = this.props;\r\n    getSessionStorageUpdateCart(cartProducts, cartTotal);\r\n    if(cartProducts.length > 0 ){\r\n\r\n      let response;\r\n\r\n      try{\r\n         response = await getStripe(cartTotal, cartProducts);\r\n      }catch(e){\r\n        return this.setState({session_error: true});\r\n      }\r\n\r\n      console.log(response);\r\n\r\n      if(response.error){\r\n        this.setState({session_error: response.error});\r\n      }else{\r\n        this.setState({client_secret: response.data});\r\n      }\r\n    }\r\n  }\r\n\r\n  handleSubmit = async (event) => {\r\n\r\n    event.preventDefault();\r\n\r\n    //set loading icon on button\r\n    this.setState({buttonLoading: true});\r\n\r\n    const {stripe, elements, cartProducts, cartTotal} = this.props\r\n    const {name, phone, email, line1, city, state, zip, client_secret} = this.state;\r\n\r\n    if (!stripe || !elements) {\r\n      // Stripe.js has not yet loaded.\r\n      // Make  sure to disable form submission until Stripe.js has loaded.\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const result = await stripe.confirmCardPayment(client_secret, {\r\n        payment_method: {\r\n          card: elements.getElement(CardElement),\r\n          billing_details: {\r\n            name: name,\r\n            phone: phone,\r\n            email: email\r\n          },\r\n        },\r\n        shipping: {\r\n          name: name,\r\n          phone: phone,\r\n          address: {\r\n            line1: line1,\r\n            city: city,\r\n            state: state,\r\n            postal_code: zip\r\n          }\r\n        }\r\n      });\r\n\r\n      if (result.error) {\r\n        this.setState({ payment_failed: true });\r\n      } else {\r\n        if (result.paymentIntent.status === 'succeeded') {\r\n\r\n          const response = await storeOrder(\r\n            result.paymentIntent,\r\n            cartProducts,\r\n            cartTotal,\r\n            name,\r\n            phone,\r\n            email);\r\n\r\n            if(response.data){\r\n              sessionStorage.removeItem('cartTotal');\r\n              sessionStorage.removeItem('cartProducts');\r\n              this.props.clearCart();\r\n              this.props.clearCartTotal();\r\n              this.setState({ order_completed: true, orderId: response.data.chargeId });\r\n            }else{\r\n              //failed to store order into database\r\n              //handle field to store order into the database\r\n              //It's already in stripe\r\n              //Send antoher request to database indicating it failed\r\n            }\r\n        }else{\r\n          //paymentIntent is something other than Succeed\r\n          //handle by sending something to our database or ignore\r\n        }\r\n      }\r\n    }catch(e){\r\n      console.log(e);\r\n      this.setState({session_error: true});\r\n    }\r\n  };\r\n\r\n  handleInputChange = (event) => {\r\n    const target = event.target;\r\n    const value = target.value;\r\n    const name = target.name;\r\n\r\n    this.setState({\r\n      [name]: value\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const { name, phone, email, line1, city, state, zip, client_secret, session_error, order_completed, orderId, buttonLoading, payment_failed } = this.state;\r\n    const { cartTotal, cartProducts } = this.props;\r\n\r\n    if(order_completed){\r\n      const descriptionOrderCompleted = `Your confirmation number is ${orderId}.\r\n      Check your email for details. If you have any questions or\r\n      concerns regarding your order please feel free to contact us.`;\r\n\r\n      return(\r\n        <Mymodal\r\n        showValue={true}\r\n        closeDirect = '/'\r\n        buttonName = 'OK'\r\n        title={`Thank You ${name}!`}\r\n        description= {descriptionOrderCompleted}\r\n        svgType=\"success\"\r\n        />\r\n      )\r\n    }\r\n\r\n    if(cartProducts.length <= 0) {\r\n      return (\r\n            <Mymodal\r\n            showValue={true}\r\n            closeDirect = '/shop'\r\n            buttonName = 'Store'\r\n            title='Cart Is Empty'\r\n            description= 'Go pick something from our store!'\r\n            svgType=\"empty\"\r\n            />\r\n      );\r\n    }\r\n\r\n    if(session_error){\r\n      const clientErrorDescription = `Looks like something went wrong.\r\n      I apologize for the inconvience. No payment was taken`;\r\n      return (\r\n            <Mymodal\r\n            showValue={true}\r\n            closeDirect = '/'\r\n            buttonName = 'Close'\r\n            title='Error'\r\n            description= {clientErrorDescription}\r\n            svgType=\"error\"\r\n            />\r\n      );\r\n    }\r\n\r\n    if(client_secret === ''){\r\n        return <Spinner />;\r\n    }\r\n\r\n    if(payment_failed){\r\n      const descriptionOrderFailed = \"Looks like your card has insufficient funds. No payment was taken.\";\r\n      return (\r\n        <Mymodal\r\n        showValue={true}\r\n        closeDirect = '/shop/checkout'\r\n        handleState = {() => this.setState({payment_failed: false, buttonLoading: false})}\r\n        buttonName = 'Try Again'\r\n        title='Payment Failed'\r\n        description= {descriptionOrderFailed}\r\n        svgType=\"warning\"\r\n        />\r\n      )\r\n    }\r\n\r\n    const formStuff = (\r\n      <>\r\n      <CartSection cartProducts={cartProducts} cartTotal={cartTotal} />\r\n          <form onSubmit={this.handleSubmit}>\r\n            <IdentitySection name={name} phone={phone} email={email} handleInputChange={this.handleInputChange}/>\r\n            <AddressSection line1={line1} city={city} state={state} zip={zip} handleInputChange={this.handleInputChange} />\r\n            <CardSection />\r\n              <button className=\"btn btn-primary btn-block\" disabled={!this.props.stripe}>\r\n                {buttonLoading && <span className=\"spinner-border spinner-border-sm\" role=\"status\" aria-hidden=\"true\"></span> }\r\n                Confirm To Pay ${cartTotal.totalPrice}\r\n              </button>\r\n          </form>\r\n      </>\r\n    );\r\n\r\n    const walletSvg = (\r\n      <svg className=\"bi bi-wallet\" style={{position:'relative', bottom: \"5px\"}} width=\"3rem\" height=\"3rem\" viewBox=\"0 0 20 20\" fill=\"currentColor\" xmlns=\"http://www.w3.org/2000/svg\">\r\n        <path fill-rule=\"evenodd\" d=\"M3.5 5a.5.5 0 00-.5.5v2h5a.5.5 0 01.5.5c0 .253.08.644.306.958.207.288.557.542 1.194.542.637 0 .987-.254 1.194-.542.226-.314.306-.705.306-.958a.5.5 0 01.5-.5h5v-2a.5.5 0 00-.5-.5h-13zM17 8.5h-4.551a2.678 2.678 0 01-.443 1.042c-.393.546-1.043.958-2.006.958-.963 0-1.613-.412-2.006-.958A2.679 2.679 0 017.551 8.5H3v6a.5.5 0 00.5.5h13a.5.5 0 00.5-.5v-6zm-15-3A1.5 1.5 0 013.5 4h13A1.5 1.5 0 0118 5.5v9a1.5 1.5 0 01-1.5 1.5h-13A1.5 1.5 0 012 14.5v-9z\" clip-rule=\"evenodd\">\r\n        </path>\r\n      </svg>\r\n    );\r\n\r\n    return (\r\n      <Modal show={true}\r\n        onHide={() => history.push('/shop')}\r\n        aria-labelledby=\"contained-modal-title-vcenter\"\r\n        centered\r\n        >\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>\r\n          <div className=\"row\">\r\n          {walletSvg}\r\n          </div>\r\n          </Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>{formStuff}</Modal.Body>\r\n      </Modal>\r\n    );\r\n\r\n  }\r\n}\r\n\r\nconst InjectedCheckoutForm = ({cartProducts, cartTotal, clearCart, clearCartTotal}) => {\r\n  return (\r\n    <ElementsConsumer>\r\n      {({stripe, elements}) => (\r\n        <CheckoutForm  stripe={stripe}\r\n          elements={elements}\r\n          cartProducts={cartProducts}\r\n          cartTotal={cartTotal}\r\n          clearCart={clearCart}\r\n          clearCartTotal={clearCartTotal}\r\n          />\r\n      )}\r\n    </ElementsConsumer>\r\n  );\r\n\r\n};\r\n\r\nconst mapStateToProps = (state) => ({\r\n  cartTotal: state.total.data,\r\n  cartProducts: state.cart.products\r\n});\r\n\r\nexport default connect(mapStateToProps, {clearCart, clearCartTotal})(InjectedCheckoutForm);\r\n"]},"metadata":{},"sourceType":"module"}