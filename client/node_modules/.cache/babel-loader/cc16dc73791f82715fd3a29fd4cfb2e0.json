{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\John\\\\Desktop\\\\Modern React With Redux Projects\\\\beersandbrewskies\\\\beersandbrewskies\\\\src\\\\components\\\\shop\\\\components\\\\checkout\\\\index.js\";\nimport React from 'react';\nimport { ElementsConsumer, CardElement } from '@stripe/react-stripe-js';\nimport { connect } from 'react-redux';\nimport CardSection from './components/CardSection';\nimport IdentitySection from './components/IdentitySection';\nimport AddressSection from './components/AddressSection';\nimport './css/CheckoutFormStyles.css';\nimport Spinner from '../../../spinner';\nimport CartSection from './components/CartSection';\nimport { getLocalStorageUpdateCart } from '../util';\nimport { getStripe, storeOrder } from '../../../../services/order/actions';\nimport { clearCart } from '../../../../services/cart/actions';\nimport { clearCartTotal } from '../../../../services/total/actions';\nimport history from '../../../../history';\nimport Modal from '../../../Modal';\n\nclass CheckoutForm extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      name: '',\n      email: '',\n      phone: '',\n      line1: '',\n      city: '',\n      state: '',\n      zip: '',\n      client_secret: '',\n      client_error: true,\n      order_completed: false,\n      orderId: '',\n      buttonLoading: false\n    };\n\n    this.componentDidMount = async () => {// const {cartTotal, cartProducts} = this.props;\n      // getLocalStorageUpdateCart(cartProducts, cartTotal);\n      // if(cartProducts.length > 0 ){\n      //   const response = await getStripe(cartTotal, cartProducts);\n      //\n      //   if(response.error){\n      //     this.setState({client_error: response.error});\n      //   }else if (response.data){\n      //     this.setState({client_secret: response.data});\n      //   }\n      //\n      // }\n    };\n\n    this.handleSubmit = async event => {\n      // We don't want to let default form submission happen here,\n      // which would refresh the page.\n      event.preventDefault();\n      const _this$props = this.props,\n            stripe = _this$props.stripe,\n            elements = _this$props.elements,\n            cartProducts = _this$props.cartProducts,\n            cartTotal = _this$props.cartTotal;\n      const _this$state = this.state,\n            name = _this$state.name,\n            phone = _this$state.phone,\n            email = _this$state.email,\n            line1 = _this$state.line1,\n            city = _this$state.city,\n            state = _this$state.state,\n            zip = _this$state.zip,\n            client_secret = _this$state.client_secret;\n\n      if (!stripe || !elements) {\n        // Stripe.js has not yet loaded.\n        // Make  sure to disable form submission until Stripe.js has loaded.\n        return;\n      }\n\n      const result = await stripe.confirmCardPayment(client_secret, {\n        payment_method: {\n          card: elements.getElement(CardElement),\n          billing_details: {\n            name: name,\n            phone: phone,\n            email: email\n          }\n        },\n        shipping: {\n          name: name,\n          address: {\n            line1: line1,\n            city: city,\n            state: state,\n            postal_code: zip\n          }\n        }\n      });\n\n      if (result.error) {\n        console.log(result.error.message);\n      } else {\n        if (result.paymentIntent.status === 'succeeded') {\n          const response = await storeOrder(result.paymentIntent, cartProducts, cartTotal, name, phone, email);\n\n          if (response.error) {\n            this.setState({\n              client_error: true\n            });\n          } else if (response.data) {\n            sessionStorage.removeItem('cartTotal');\n            sessionStorage.removeItem('cartProducts');\n            this.props.clearCart();\n            this.props.clearCartTotal();\n            this.setState({\n              order_completed: true,\n              orderId: response.data.chargeId\n            });\n          } else {\n            this.setState({\n              client_error: true\n            });\n          }\n        }\n      }\n    };\n\n    this.handleInputChange = event => {\n      const target = event.target;\n      const value = target.value;\n      const name = target.name;\n      this.setState({\n        [name]: value\n      });\n    };\n  }\n\n  render() {\n    const _this$state2 = this.state,\n          name = _this$state2.name,\n          phone = _this$state2.phone,\n          email = _this$state2.email,\n          line1 = _this$state2.line1,\n          city = _this$state2.city,\n          state = _this$state2.state,\n          zip = _this$state2.zip,\n          client_secret = _this$state2.client_secret,\n          client_error = _this$state2.client_error,\n          order_completed = _this$state2.order_completed,\n          orderId = _this$state2.orderId,\n          buttonLoading = _this$state2.buttonLoading;\n    const _this$props2 = this.props,\n          cartTotal = _this$props2.cartTotal,\n          cartProducts = _this$props2.cartProducts;\n\n    if (client_error) {\n      return React.createElement(\"div\", {\n        className: \"alert alert-warning\",\n        role: \"alert\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 128\n        },\n        __self: this\n      }, React.createElement(\"h4\", {\n        className: \"alert-heading\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 129\n        },\n        __self: this\n      }, \"Ooops!\"), React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 130\n        },\n        __self: this\n      }, \"Looks like something went wrong. We will look into it. I apologize for the inconvience. Feel free to contact us with any questions or concerns.\"));\n    }\n\n    if (order_completed) {\n      const description = `Your confirmation number is ${orderId}.\n      Check your email for details. If you have any questions or\n      concerns regarding your order please feel free to contact us.`;\n      return React.createElement(Modal, {\n        showValue: true,\n        closeDirect: \"/\",\n        buttonName: \"OK\",\n        title: `Thank You ${name}!`,\n        description: description,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 143\n        },\n        __self: this\n      });\n    }\n\n    if (cartProducts.length <= 0) {\n      return React.createElement(\"h1\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154\n        },\n        __self: this\n      }, \"Cart is empty\");\n    }\n\n    if (client_secret === '') {\n      if (client_error) {\n        return React.createElement(\"h1\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 159\n          },\n          __self: this\n        }, \"We have a problem :(\");\n      } else {\n        return React.createElement(Spinner, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 161\n          },\n          __self: this\n        });\n      }\n    }\n\n    return React.createElement(\"div\", {\n      className: \"row\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"col-md-4 order-md-2 mb-4\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167\n      },\n      __self: this\n    }, React.createElement(CartSection, {\n      cartTotal: cartTotal,\n      cartProducts: cartProducts,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"col-md-8 order-md-1\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170\n      },\n      __self: this\n    }, React.createElement(\"form\", {\n      onSubmit: this.handleSubmit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171\n      },\n      __self: this\n    }, React.createElement(IdentitySection, {\n      name: name,\n      phone: phone,\n      email: email,\n      handleInputChange: this.handleInputChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172\n      },\n      __self: this\n    }), React.createElement(AddressSection, {\n      line1: line1,\n      city: city,\n      state: state,\n      zip: zip,\n      handleInputChange: this.handleInputChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173\n      },\n      __self: this\n    }), React.createElement(CardSection, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      className: \"btn btn-primary\",\n      disabled: !this.props.stripe,\n      onClick: () => this.setState({\n        buttonLoading: true\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175\n      },\n      __self: this\n    }, buttonLoading && React.createElement(\"span\", {\n      className: \"spinner-border spinner-border-sm\",\n      role: \"status\",\n      \"aria-hidden\": \"true\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176\n      },\n      __self: this\n    }), \"Confirm\"))));\n  }\n\n}\n\nconst InjectedCheckoutForm = ({\n  cartProducts,\n  cartTotal,\n  clearCart,\n  clearCartTotal\n}) => {\n  return React.createElement(ElementsConsumer, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188\n    },\n    __self: this\n  }, ({\n    stripe,\n    elements\n  }) => React.createElement(CheckoutForm, {\n    stripe: stripe,\n    elements: elements,\n    cartProducts: cartProducts,\n    cartTotal: cartTotal,\n    clearCart: clearCart,\n    clearCartTotal: clearCartTotal,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190\n    },\n    __self: this\n  }));\n};\n\nconst mapStateToProps = state => ({\n  cartTotal: state.total.data,\n  cartProducts: state.cart.products\n});\n\nexport default connect(mapStateToProps, {\n  clearCart,\n  clearCartTotal\n})(InjectedCheckoutForm);","map":{"version":3,"sources":["C:/Users/John/Desktop/Modern React With Redux Projects/beersandbrewskies/beersandbrewskies/src/components/shop/components/checkout/index.js"],"names":["React","ElementsConsumer","CardElement","connect","CardSection","IdentitySection","AddressSection","Spinner","CartSection","getLocalStorageUpdateCart","getStripe","storeOrder","clearCart","clearCartTotal","history","Modal","CheckoutForm","Component","state","name","email","phone","line1","city","zip","client_secret","client_error","order_completed","orderId","buttonLoading","componentDidMount","handleSubmit","event","preventDefault","props","stripe","elements","cartProducts","cartTotal","result","confirmCardPayment","payment_method","card","getElement","billing_details","shipping","address","postal_code","error","console","log","message","paymentIntent","status","response","setState","data","sessionStorage","removeItem","chargeId","handleInputChange","target","value","render","description","length","InjectedCheckoutForm","mapStateToProps","total","cart","products"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport {ElementsConsumer, CardElement} from '@stripe/react-stripe-js';\r\nimport { connect } from 'react-redux';\r\nimport CardSection from './components/CardSection';\r\nimport IdentitySection from './components/IdentitySection';\r\nimport AddressSection from './components/AddressSection';\r\nimport './css/CheckoutFormStyles.css';\r\nimport Spinner from '../../../spinner'\r\nimport CartSection from './components/CartSection';\r\nimport { getLocalStorageUpdateCart } from '../util';\r\nimport { getStripe, storeOrder } from '../../../../services/order/actions';\r\nimport { clearCart } from '../../../../services/cart/actions';\r\nimport { clearCartTotal } from '../../../../services/total/actions';\r\nimport history from '../../../../history';\r\nimport Modal from '../../../Modal';\r\n\r\nclass CheckoutForm extends React.Component {\r\n\r\n  state = {\r\n    name: '',\r\n    email: '',\r\n    phone: '',\r\n    line1: '',\r\n    city: '',\r\n    state: '',\r\n    zip: '',\r\n    client_secret: '',\r\n    client_error: true,\r\n    order_completed: false,\r\n    orderId: '',\r\n    buttonLoading: false\r\n  }\r\n\r\n  componentDidMount = async() => {\r\n    // const {cartTotal, cartProducts} = this.props;\r\n    // getLocalStorageUpdateCart(cartProducts, cartTotal);\r\n    // if(cartProducts.length > 0 ){\r\n    //   const response = await getStripe(cartTotal, cartProducts);\r\n    //\r\n    //   if(response.error){\r\n    //     this.setState({client_error: response.error});\r\n    //   }else if (response.data){\r\n    //     this.setState({client_secret: response.data});\r\n    //   }\r\n    //\r\n    // }\r\n  }\r\n\r\n  handleSubmit = async (event) => {\r\n    // We don't want to let default form submission happen here,\r\n    // which would refresh the page.\r\n    event.preventDefault();\r\n\r\n    const {stripe, elements, cartProducts, cartTotal} = this.props\r\n    const {name, phone, email, line1, city, state, zip, client_secret} = this.state;\r\n\r\n    if (!stripe || !elements) {\r\n      // Stripe.js has not yet loaded.\r\n      // Make  sure to disable form submission until Stripe.js has loaded.\r\n      return;\r\n    }\r\n\r\n    const result = await stripe.confirmCardPayment(client_secret, {\r\n      payment_method: {\r\n        card: elements.getElement(CardElement),\r\n        billing_details: {\r\n          name: name,\r\n          phone: phone,\r\n          email: email\r\n        },\r\n      },\r\n      shipping: {\r\n        name: name,\r\n        address: {\r\n          line1: line1,\r\n          city: city,\r\n          state: state,\r\n          postal_code: zip\r\n        }\r\n      }\r\n    });\r\n\r\n    if (result.error) {\r\n      console.log(result.error.message);\r\n    } else {\r\n      if (result.paymentIntent.status === 'succeeded') {\r\n\r\n        const response = await storeOrder(\r\n          result.paymentIntent,\r\n          cartProducts,\r\n          cartTotal,\r\n          name,\r\n          phone,\r\n          email);\r\n\r\n          if(response.error){\r\n            this.setState({client_error: true});\r\n          }else if(response.data){\r\n            sessionStorage.removeItem('cartTotal');\r\n            sessionStorage.removeItem('cartProducts');\r\n            this.props.clearCart();\r\n            this.props.clearCartTotal();\r\n            this.setState({ order_completed: true, orderId: response.data.chargeId });\r\n          }else{\r\n            this.setState({client_error: true});\r\n          }\r\n\r\n      }\r\n    }\r\n  };\r\n\r\n  handleInputChange = (event) => {\r\n    const target = event.target;\r\n    const value = target.value;\r\n    const name = target.name;\r\n\r\n    this.setState({\r\n      [name]: value\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const { name, phone, email, line1, city, state, zip, client_secret, client_error, order_completed, orderId,buttonLoading } = this.state;\r\n    const { cartTotal, cartProducts } = this.props;\r\n\r\n    if(client_error) {\r\n      return (\r\n              <div className=\"alert alert-warning\" role=\"alert\">\r\n          <h4 className=\"alert-heading\">Ooops!</h4>\r\n          <p>Looks like something went wrong. We will look into it. I apologize for the inconvience.\r\n            Feel free to contact us with any questions or concerns.</p>\r\n        </div>\r\n      )\r\n\r\n    }\r\n\r\n    if(order_completed){\r\n      const description = `Your confirmation number is ${orderId}.\r\n      Check your email for details. If you have any questions or\r\n      concerns regarding your order please feel free to contact us.`;\r\n\r\n      return(\r\n        <Modal\r\n        showValue={true}\r\n        closeDirect = '/'\r\n        buttonName = 'OK'\r\n        title={`Thank You ${name}!`}\r\n        description= {description}\r\n        />\r\n      )\r\n    }\r\n\r\n    if(cartProducts.length <= 0) {\r\n      return <h1>Cart is empty</h1>;\r\n    }\r\n\r\n    if(client_secret === ''){\r\n      if(client_error){\r\n        return <h1>We have a problem :(</h1>;\r\n      }else{\r\n        return <Spinner />;\r\n      }\r\n    }\r\n\r\n    return (\r\n      <div className=\"row\">\r\n      <div className=\"col-md-4 order-md-2 mb-4\">\r\n        <CartSection cartTotal={cartTotal} cartProducts={cartProducts} />\r\n      </div>\r\n      <div className=\"col-md-8 order-md-1\">\r\n        <form onSubmit={this.handleSubmit}>\r\n          <IdentitySection name={name} phone={phone} email={email} handleInputChange={this.handleInputChange}/>\r\n          <AddressSection line1={line1} city={city} state={state} zip={zip} handleInputChange={this.handleInputChange} />\r\n          <CardSection />\r\n            <button className=\"btn btn-primary\" disabled={!this.props.stripe} onClick={() => this.setState({buttonLoading: true})}>\r\n              {buttonLoading && <span className=\"spinner-border spinner-border-sm\" role=\"status\" aria-hidden=\"true\"></span> }\r\n              Confirm\r\n            </button>\r\n        </form>\r\n      </div>\r\n    </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst InjectedCheckoutForm = ({cartProducts, cartTotal, clearCart, clearCartTotal}) => {\r\n  return (\r\n    <ElementsConsumer>\r\n      {({stripe, elements}) => (\r\n        <CheckoutForm  stripe={stripe}\r\n          elements={elements}\r\n          cartProducts={cartProducts}\r\n          cartTotal={cartTotal}\r\n          clearCart={clearCart}\r\n          clearCartTotal={clearCartTotal}\r\n          />\r\n      )}\r\n    </ElementsConsumer>\r\n  );\r\n\r\n};\r\n\r\nconst mapStateToProps = (state) => ({\r\n  cartTotal: state.total.data,\r\n  cartProducts: state.cart.products\r\n});\r\n\r\nexport default connect(mapStateToProps, {clearCart, clearCartTotal})(InjectedCheckoutForm);\r\n"]},"metadata":{},"sourceType":"module"}